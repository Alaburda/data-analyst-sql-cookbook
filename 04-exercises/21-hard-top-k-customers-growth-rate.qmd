---
title: "[Hard] Top-K Customers by Growth Rate"
filters:
  - interactive-duckdb
databases:
  - name: cookbook
    path: "https://raw.githubusercontent.com/Alaburda/data-analyst-sql-cookbook/master/db/cookbook.duckdb"
    format: duckdb
---

# Problem Statement

Identify the top K customers with the largest percentage increase in spend between two time periods. Handle edge cases including zero baseline spending, new customers, churned customers, and normalize for different time period lengths.

**Skills tested:** Period-over-period comparison, Growth rate calculations, Handling division by zero, Window functions, NTILE for percentiles, Complex filtering

## Schema

### customers
```
customer_id    INTEGER
email          VARCHAR
first_name     VARCHAR
last_name      VARCHAR
created_date   DATE
```

### orders
```
order_id       INTEGER
customer_id    INTEGER
order_date     DATE
status         VARCHAR
```

### order_items
```
order_item_id  INTEGER
order_id       INTEGER
product_id     INTEGER
quantity       INTEGER
unit_price     DECIMAL
line_total     DECIMAL
```

## Sample Data

```{.sql .interactive .cookbook}
-- Compare customer spending across periods
WITH period_spend AS (
    SELECT 
        o.customer_id,
        c.first_name || ' ' || c.last_name AS customer_name,
        CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' 
            THEN 'Period1'
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN 'Period2'
        END AS period,
        SUM(oi.line_total) AS total_spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN customers c ON o.customer_id = c.customer_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, customer_name, period
)
SELECT 
    customer_id,
    customer_name,
    SUM(CASE WHEN period = 'Period1' THEN total_spend ELSE 0 END) AS period1_spend,
    SUM(CASE WHEN period = 'Period2' THEN total_spend ELSE 0 END) AS period2_spend
FROM period_spend
GROUP BY customer_id, customer_name
ORDER BY customer_id
LIMIT 10;
```

## Expected Output

| rank | customer_id | customer_name  | period1_spend | period2_spend | absolute_growth | growth_rate_pct | growth_type        |
|------|-------------|----------------|---------------|---------------|-----------------|-----------------|-------------------|
| 1    | 4523        | Alice Johnson  | 150.00        | 2450.00       | 2300.00         | 1533.33%        | Accelerated       |
| 2    | 8821        | Bob Smith      | 0.00          | 1850.00       | 1850.00         | ∞               | New Customer      |
| 3    | 2341        | Carol White    | 230.00        | 1920.00       | 1690.00         | 734.78%         | High Growth       |
| 4    | 6754        | David Brown    | 520.00        | 2100.00       | 1580.00         | 303.85%         | Strong Growth     |
| 5    | 1092        | Emma Davis     | 75.00         | 850.00        | 775.00          | 1033.33%        | Accelerated       |

## Requirements

1. Compare spending between two configurable time periods (e.g., Q1 vs Q2, or last 90 days vs previous 90 days)
2. Calculate percentage growth rate: `(period2 - period1) / period1 * 100`
3. Handle zero baseline cases (new customers in period 2 who spent nothing in period 1)
4. Include absolute growth amount alongside percentage
5. Only include completed orders
6. Return top K customers (e.g., top 10, top 20) by growth rate
7. Provide growth classification (e.g., "Accelerated", "High Growth", "Moderate")
8. Handle negative growth (declining customers) separately
9. Exclude customers with trivial amounts (e.g., less than $10 in either period)

## Hints

<details>
<summary>Click to reveal hint 1</summary>

Define time periods using CASE statements:
```sql
CASE 
    WHEN order_date BETWEEN '2024-01-01' AND '2024-03-31' THEN 'Q1'
    WHEN order_date BETWEEN '2024-04-01' AND '2024-06-30' THEN 'Q2'
END AS period
```

Then pivot with conditional aggregation.

</details>

<details>
<summary>Click to reveal hint 2</summary>

Handle division by zero with NULLIF:
```sql
ROUND(
    100.0 * (period2_spend - period1_spend) / NULLIF(period1_spend, 0), 
    2
) AS growth_rate_pct
```

For zero baseline, you can mark it specially or treat as infinite growth.

</details>

<details>
<summary>Click to reveal hint 3</summary>

Use CASE to classify growth rates:
```sql
CASE 
    WHEN period1_spend = 0 THEN 'New Customer'
    WHEN growth_rate > 500 THEN 'Accelerated'
    WHEN growth_rate > 100 THEN 'High Growth'
    WHEN growth_rate > 50 THEN 'Strong Growth'
    WHEN growth_rate > 0 THEN 'Moderate Growth'
    ELSE 'Declining'
END AS growth_type
```

</details>

<details>
<summary>Click to reveal hint 4</summary>

Use ROW_NUMBER or RANK with ORDER BY to get top K:
```sql
SELECT *
FROM (
    SELECT 
        *,
        ROW_NUMBER() OVER (ORDER BY growth_rate DESC) AS rank
    FROM growth_analysis
) ranked
WHERE rank <= 10
```

</details>

## Solution Template

```{.sql .interactive .cookbook}
WITH period_definitions AS (
    SELECT 
        o.customer_id,
        CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN 'Period1'
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN 'Period2'
        END AS period,
        SUM(oi.line_total) AS spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, period
),
customer_spend AS (
    SELECT 
        customer_id,
        -- Pivot periods into columns
    FROM period_definitions
    GROUP BY customer_id
)
SELECT 
    customer_id,
    -- Calculate growth metrics
FROM customer_spend
WHERE -- Filter criteria
ORDER BY -- Sort by growth rate
LIMIT 10;
```

## Solution

<details>
<summary>Click to reveal basic top-K growth solution</summary>

```{.sql .interactive .cookbook}
WITH period_definitions AS (
    SELECT 
        o.customer_id,
        CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN 'Period1'
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN 'Period2'
        END AS period,
        SUM(oi.line_total) AS spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, period
),
customer_spend AS (
    SELECT 
        customer_id,
        COALESCE(SUM(CASE WHEN period = 'Period1' THEN spend END), 0) AS period1_spend,
        COALESCE(SUM(CASE WHEN period = 'Period2' THEN spend END), 0) AS period2_spend
    FROM period_definitions
    WHERE period IS NOT NULL
    GROUP BY customer_id
),
growth_calc AS (
    SELECT 
        cs.customer_id,
        c.first_name || ' ' || c.last_name AS customer_name,
        cs.period1_spend,
        cs.period2_spend,
        cs.period2_spend - cs.period1_spend AS absolute_growth,
        CASE 
            WHEN cs.period1_spend = 0 AND cs.period2_spend > 0 THEN 999999  -- Sentinel for infinite growth
            WHEN cs.period1_spend = 0 THEN 0
            ELSE ROUND(100.0 * (cs.period2_spend - cs.period1_spend) / cs.period1_spend, 2)
        END AS growth_rate_pct
    FROM customer_spend cs
    JOIN customers c ON cs.customer_id = c.customer_id
    WHERE cs.period2_spend > 0  -- Must have activity in period 2
)
SELECT 
    ROW_NUMBER() OVER (ORDER BY growth_rate_pct DESC, absolute_growth DESC) AS rank,
    customer_id,
    customer_name,
    ROUND(period1_spend, 2) AS period1_spend,
    ROUND(period2_spend, 2) AS period2_spend,
    ROUND(absolute_growth, 2) AS absolute_growth,
    CASE 
        WHEN growth_rate_pct = 999999 THEN '∞ (New)'
        ELSE ROUND(growth_rate_pct, 1) || '%'
    END AS growth_rate
FROM growth_calc
ORDER BY rank
LIMIT 10;
```

</details>

<details>
<summary>Click to reveal solution with growth classification</summary>

```{.sql .interactive .cookbook}
WITH period_definitions AS (
    SELECT 
        o.customer_id,
        CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN 'Period1'
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN 'Period2'
        END AS period,
        SUM(oi.line_total) AS spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, period
),
customer_spend AS (
    SELECT 
        customer_id,
        COALESCE(SUM(CASE WHEN period = 'Period1' THEN spend END), 0) AS period1_spend,
        COALESCE(SUM(CASE WHEN period = 'Period2' THEN spend END), 0) AS period2_spend
    FROM period_definitions
    WHERE period IS NOT NULL
    GROUP BY customer_id
),
growth_calc AS (
    SELECT 
        cs.customer_id,
        c.first_name || ' ' || c.last_name AS customer_name,
        c.email,
        cs.period1_spend,
        cs.period2_spend,
        cs.period2_spend - cs.period1_spend AS absolute_growth,
        CASE 
            WHEN cs.period1_spend = 0 AND cs.period2_spend > 0 THEN NULL  -- Handle separately
            WHEN cs.period1_spend = 0 THEN 0
            ELSE ROUND(100.0 * (cs.period2_spend - cs.period1_spend) / cs.period1_spend, 2)
        END AS growth_rate_pct,
        CASE 
            WHEN cs.period1_spend = 0 AND cs.period2_spend > 0 THEN 'New Customer'
            WHEN 100.0 * (cs.period2_spend - cs.period1_spend) / NULLIF(cs.period1_spend, 0) > 500 THEN 'Accelerated Growth'
            WHEN 100.0 * (cs.period2_spend - cs.period1_spend) / NULLIF(cs.period1_spend, 0) > 200 THEN 'High Growth'
            WHEN 100.0 * (cs.period2_spend - cs.period1_spend) / NULLIF(cs.period1_spend, 0) > 50 THEN 'Strong Growth'
            WHEN 100.0 * (cs.period2_spend - cs.period1_spend) / NULLIF(cs.period1_spend, 0) > 0 THEN 'Moderate Growth'
            WHEN cs.period2_spend = cs.period1_spend THEN 'Flat'
            ELSE 'Declining'
        END AS growth_type
    FROM customer_spend cs
    JOIN customers c ON cs.customer_id = c.customer_id
    WHERE cs.period2_spend >= 10  -- Minimum threshold
        OR cs.period1_spend >= 10
)
SELECT 
    ROW_NUMBER() OVER (
        ORDER BY 
            CASE WHEN period1_spend = 0 THEN 1 ELSE 0 END DESC,  -- New customers first
            COALESCE(growth_rate_pct, 999999) DESC,
            absolute_growth DESC
    ) AS rank,
    customer_id,
    customer_name,
    ROUND(period1_spend, 2) AS period1_spend,
    ROUND(period2_spend, 2) AS period2_spend,
    ROUND(absolute_growth, 2) AS absolute_growth,
    COALESCE(ROUND(growth_rate_pct, 1), 0) AS growth_rate_pct,
    growth_type
FROM growth_calc
WHERE growth_type IN ('New Customer', 'Accelerated Growth', 'High Growth', 'Strong Growth')
ORDER BY rank
LIMIT 20;
```

</details>

<details>
<summary>Click to reveal solution with configurable time periods</summary>

```{.sql .interactive .cookbook}
WITH period_config AS (
    -- Configure comparison periods
    SELECT 
        CURRENT_DATE - INTERVAL '6 months' AS period1_start,
        CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day' AS period1_end,
        CURRENT_DATE - INTERVAL '3 months' AS period2_start,
        CURRENT_DATE AS period2_end
),
period_spend AS (
    SELECT 
        o.customer_id,
        c.first_name || ' ' || c.last_name AS customer_name,
        c.email,
        SUM(CASE 
            WHEN o.order_date BETWEEN pc.period1_start AND pc.period1_end 
            THEN oi.line_total 
            ELSE 0 
        END) AS period1_spend,
        SUM(CASE 
            WHEN o.order_date BETWEEN pc.period2_start AND pc.period2_end 
            THEN oi.line_total 
            ELSE 0 
        END) AS period2_spend,
        COUNT(DISTINCT CASE 
            WHEN o.order_date BETWEEN pc.period1_start AND pc.period1_end 
            THEN o.order_id 
        END) AS period1_orders,
        COUNT(DISTINCT CASE 
            WHEN o.order_date BETWEEN pc.period2_start AND pc.period2_end 
            THEN o.order_id 
        END) AS period2_orders
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN customers c ON o.customer_id = c.customer_id
    CROSS JOIN period_config pc
    WHERE o.status = 'completed'
        AND o.order_date >= pc.period1_start
        AND o.order_date <= pc.period2_end
    GROUP BY o.customer_id, customer_name, c.email
),
growth_metrics AS (
    SELECT 
        customer_id,
        customer_name,
        email,
        period1_spend,
        period2_spend,
        period1_orders,
        period2_orders,
        period2_spend - period1_spend AS absolute_growth,
        ROUND(100.0 * (period2_spend - period1_spend) / NULLIF(period1_spend, 0), 2) AS growth_rate_pct,
        ROUND(period2_spend / NULLIF(period2_orders, 0), 2) AS period2_aov,
        ROUND(period1_spend / NULLIF(period1_orders, 0), 2) AS period1_aov
    FROM period_spend
    WHERE period2_spend > 0  -- Active in period 2
        AND (period1_spend >= 50 OR period2_spend >= 50)  -- Material amounts
)
SELECT 
    ROW_NUMBER() OVER (ORDER BY 
        CASE WHEN period1_spend = 0 THEN 999999 ELSE growth_rate_pct END DESC,
        absolute_growth DESC
    ) AS rank,
    customer_id,
    customer_name,
    ROUND(period1_spend, 2) AS period1_spend,
    ROUND(period2_spend, 2) AS period2_spend,
    ROUND(absolute_growth, 2) AS absolute_growth,
    CASE 
        WHEN period1_spend = 0 THEN '∞ (New)'
        ELSE ROUND(growth_rate_pct, 1) || '%'
    END AS growth_rate,
    period1_orders || ' → ' || period2_orders AS order_frequency,
    CASE 
        WHEN period1_spend = 0 THEN 'New Customer'
        WHEN growth_rate_pct >= 500 THEN 'Accelerated'
        WHEN growth_rate_pct >= 200 THEN 'High Growth'
        WHEN growth_rate_pct >= 50 THEN 'Strong Growth'
        ELSE 'Moderate Growth'
    END AS segment
FROM growth_metrics
ORDER BY rank
LIMIT 20;
```

</details>

## Declining Customers Analysis

<details>
<summary>Click to reveal customers with largest declines</summary>

Identify at-risk customers with declining spend:

```{.sql .interactive .cookbook}
WITH period_definitions AS (
    SELECT 
        o.customer_id,
        CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN 'Period1'
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN 'Period2'
        END AS period,
        SUM(oi.line_total) AS spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, period
),
customer_spend AS (
    SELECT 
        customer_id,
        COALESCE(SUM(CASE WHEN period = 'Period1' THEN spend END), 0) AS period1_spend,
        COALESCE(SUM(CASE WHEN period = 'Period2' THEN spend END), 0) AS period2_spend
    FROM period_definitions
    WHERE period IS NOT NULL
    GROUP BY customer_id
),
decline_calc AS (
    SELECT 
        cs.customer_id,
        c.first_name || ' ' || c.last_name AS customer_name,
        c.email,
        cs.period1_spend,
        cs.period2_spend,
        cs.period1_spend - cs.period2_spend AS revenue_at_risk,
        ROUND(100.0 * (cs.period2_spend - cs.period1_spend) / cs.period1_spend, 2) AS decline_pct
    FROM customer_spend cs
    JOIN customers c ON cs.customer_id = c.customer_id
    WHERE cs.period1_spend >= 100  -- Meaningful baseline
        AND cs.period2_spend < cs.period1_spend  -- Declining
)
SELECT 
    ROW_NUMBER() OVER (ORDER BY decline_pct ASC, revenue_at_risk DESC) AS rank,
    customer_id,
    customer_name,
    email,
    ROUND(period1_spend, 2) AS period1_spend,
    ROUND(period2_spend, 2) AS period2_spend,
    ROUND(revenue_at_risk, 2) AS revenue_at_risk,
    ROUND(decline_pct, 1) AS decline_pct,
    CASE 
        WHEN period2_spend = 0 THEN 'Churned'
        WHEN decline_pct < -75 THEN 'Severe Decline'
        WHEN decline_pct < -50 THEN 'Major Decline'
        WHEN decline_pct < -25 THEN 'Moderate Decline'
        ELSE 'Minor Decline'
    END AS risk_level
FROM decline_calc
ORDER BY rank
LIMIT 20;
```

</details>

## Growth by Cohort

<details>
<summary>Click to reveal growth rates by customer cohort</summary>

```{.sql .interactive .cookbook}
WITH customer_cohorts AS (
    SELECT 
        customer_id,
        DATE_TRUNC('month', created_date) AS cohort_month,
        DATEDIFF('month', created_date, CURRENT_DATE) AS months_since_signup
    FROM customers
),
period_spend AS (
    SELECT 
        o.customer_id,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN oi.line_total 
            ELSE 0 
        END) AS period1_spend,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN oi.line_total 
            ELSE 0 
        END) AS period2_spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id
),
cohort_growth AS (
    SELECT 
        cc.cohort_month,
        cc.months_since_signup,
        COUNT(DISTINCT ps.customer_id) AS customers,
        SUM(ps.period1_spend) AS cohort_period1_spend,
        SUM(ps.period2_spend) AS cohort_period2_spend,
        ROUND(100.0 * (SUM(ps.period2_spend) - SUM(ps.period1_spend)) / 
              NULLIF(SUM(ps.period1_spend), 0), 2) AS cohort_growth_rate
    FROM customer_cohorts cc
    JOIN period_spend ps ON cc.customer_id = ps.customer_id
    WHERE ps.period1_spend > 0 OR ps.period2_spend > 0
    GROUP BY cc.cohort_month, cc.months_since_signup
)
SELECT 
    cohort_month,
    months_since_signup AS cohort_age_months,
    customers,
    ROUND(cohort_period1_spend, 2) AS period1_total,
    ROUND(cohort_period2_spend, 2) AS period2_total,
    ROUND(cohort_period1_spend / customers, 2) AS period1_per_customer,
    ROUND(cohort_period2_spend / customers, 2) AS period2_per_customer,
    cohort_growth_rate || '%' AS growth_rate
FROM cohort_growth
WHERE customers >= 5  -- Minimum cohort size
ORDER BY cohort_month DESC, months_since_signup;
```

</details>

## Percentile-Based Growth Ranking

<details>
<summary>Click to reveal growth percentile analysis</summary>

```{.sql .interactive .cookbook}
WITH period_spend AS (
    SELECT 
        o.customer_id,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN oi.line_total 
            ELSE 0 
        END) AS period1_spend,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN oi.line_total 
            ELSE 0 
        END) AS period2_spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id
),
growth_calc AS (
    SELECT 
        customer_id,
        period1_spend,
        period2_spend,
        period2_spend - period1_spend AS absolute_growth,
        CASE 
            WHEN period1_spend = 0 THEN NULL
            ELSE 100.0 * (period2_spend - period1_spend) / period1_spend
        END AS growth_rate
    FROM period_spend
    WHERE period1_spend > 0 AND period2_spend > 0  -- Exclude new and churned
        AND period1_spend >= 50  -- Minimum baseline
)
SELECT 
    NTILE(10) OVER (ORDER BY growth_rate) AS growth_decile,
    COUNT(*) AS customers,
    ROUND(MIN(growth_rate), 1) AS min_growth_rate,
    ROUND(MAX(growth_rate), 1) AS max_growth_rate,
    ROUND(AVG(growth_rate), 1) AS avg_growth_rate,
    ROUND(MEDIAN(growth_rate), 1) AS median_growth_rate,
    ROUND(AVG(absolute_growth), 2) AS avg_absolute_growth
FROM growth_calc
GROUP BY growth_decile
ORDER BY growth_decile DESC;
```

</details>

## Product Category Growth

<details>
<summary>Click to reveal growth by product category purchased</summary>

```{.sql .interactive .cookbook}
WITH period_spend AS (
    SELECT 
        o.customer_id,
        p.category,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '6 months' 
                                  AND CURRENT_DATE - INTERVAL '3 months' - INTERVAL '1 day'
            THEN oi.line_total 
            ELSE 0 
        END) AS period1_spend,
        SUM(CASE 
            WHEN o.order_date BETWEEN CURRENT_DATE - INTERVAL '3 months' 
                                  AND CURRENT_DATE
            THEN oi.line_total 
            ELSE 0 
        END) AS period2_spend
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE o.status = 'completed'
        AND o.order_date >= CURRENT_DATE - INTERVAL '6 months'
    GROUP BY o.customer_id, p.category
)
SELECT 
    category,
    COUNT(DISTINCT customer_id) AS customers,
    ROUND(SUM(period1_spend), 2) AS total_period1,
    ROUND(SUM(period2_spend), 2) AS total_period2,
    ROUND(SUM(period2_spend - period1_spend), 2) AS absolute_growth,
    ROUND(100.0 * (SUM(period2_spend) - SUM(period1_spend)) / NULLIF(SUM(period1_spend), 0), 1) AS growth_rate_pct
FROM period_spend
WHERE period1_spend > 0 OR period2_spend > 0
GROUP BY category
ORDER BY growth_rate_pct DESC;
```

</details>

## Extensions

1. **Multi-period trend analysis:** Track growth across 3+ time periods to identify acceleration/deceleration
2. **Seasonality adjustment:** Normalize growth rates for seasonal businesses (e.g., retail, travel)
3. **RFM integration:** Combine growth rates with recency, frequency, and monetary scores
4. **Predictive growth scoring:** Use historical patterns to predict future high-growth customers
5. **Channel attribution:** Analyze which marketing channels drive highest growth customers
6. **Product affinity:** Identify product combinations that drive growth
7. **Geographic growth:** Compare growth rates across regions or countries
8. **Lifetime value projection:** Estimate future LTV based on growth trajectory
